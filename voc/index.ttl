@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix bot: <https://w3id.org/bot#> .
@prefix dct: <http://purl.org/dc/terms/> .
@prefix dcat: <http://www.w3.org/ns/dcat#> .
@prefix ssn: <http://www.w3.org/ns/ssn/> .
@prefix sosa: <http://www.w3.org/ns/sosa/> .
@prefix prov: <http://www.w3.org/ns/prov#> .
@prefix skos: <http://www.w3.org/2004/02/skos/core#> .
@prefix foaf: <http://xmlns.com/foaf/0.1/> .
@prefix dob: <https://w3id.org/dob/voc#> .

###################################################
### ONTOLOGY METADATA
###################################################

dob: a owl:Ontology ;
    dct:title "Open Built Environment Data Ontology"@en ;
    owl:imports prov:, sosa:, ssn:, bot:, dcat:, dct: ;
    dct:license <http://creativecommons.org/licenses/by/4.0/> ;
    dct:creator [
        a foaf:Organization ;
        foaf:name "xRI" ;
        foaf:homepage <https://www.xri.online/>
    ] .

###################################################
### CLASSES
###################################################

# 1) Result

dob:Result a owl:Class ;
    rdfs:subClassOf prov:Entity ,
                    skos:Concept ;
    rdfs:label "Result"@en ;
    rdfs:comment "An atomic data point generated by a process execution, linked to a feature of interest within a zone."@en ;
    # Restriction: must be generated by a ProcessExecution
    rdfs:subClassOf [
        a owl:Restriction ;
        owl:onProperty prov:isGeneratedBy ;
        owl:allValuesFrom dob:ProcessExecution
    ] ;
    # Restriction: must have a FeatureOfInterest
    rdfs:subClassOf [
        a owl:Restriction ;
        owl:onProperty sosa:hasFeatureOfInterest ;
        owl:allValuesFrom sosa:FeatureOfInterest
    ] ;
    # Restriction: must reference a BOT Zone
    rdfs:subClassOf [
        a owl:Restriction ;
        owl:onProperty dob:hasZone ;
        owl:allValuesFrom bot:Zone
    ] ;
    # Restriction: rdf:value can be one of [string, double, anyURI, boolean, dateTime, integer, float, decimal, time, date]
    rdfs:subClassOf [
        a owl:Restriction ;
        owl:onProperty rdf:value ;
        owl:allValuesFrom [
            owl:unionOf (
                xsd:string
                xsd:double
                xsd:anyURI
                xsd:boolean
                xsd:dateTime
                xsd:integer
                xsd:float
                xsd:decimal
                xsd:time
                xsd:date
            )
        ]
    ] .

# 2) ProcessExecution

dob:ProcessExecution a owl:Class ; 
    owl:equivalentClass [
        owl:unionOf (prov:Entity prov:Activity)
    ] ;
    rdfs:label "Process Execution"@en ;
    rdfs:comment "An execution of a process (e.g., a software pipeline and sensor observation), producing one or more results for multiple zones."@en ;
    # Restriction: used at least one SoftwarePipeline
    rdfs:subClassOf [
        a owl:Restriction ;
        owl:onProperty dob:usedPipeline ;
        owl:someValuesFrom dob:SoftwarePipeline
    ] .

# 3) SoftwarePipeline

dob:SoftwarePipeline a owl:Class ;
    rdfs:subClassOf prov:Entity ;
    rdfs:label "Software Pipeline"@en ;
    rdfs:comment "A software-based workflow or pipeline that can be used by an Activity, specializing prov:Entity."@en .

# 4) CodeRepository

dob:CodeRepository a owl:Class ;
    rdfs:subClassOf prov:Entity ;
    rdfs:label "Code Repository"@en ;
    rdfs:comment "A repository (e.g., Git) containing source code for a software pipeline."@en .

# 5) CodeRevision

dob:CodeRevision a owl:Class ;
    rdfs:subClassOf prov:Entity ;
    rdfs:label "Code Revision"@en ;
    rdfs:comment "A specific revision of code (e.g., a branch or a snapshot) in a repository."@en .

# 6) CodeCommit

dob:CodeCommit a owl:Class ;
    rdfs:subClassOf 
        prov:Entity ,
        [
            a owl:Restriction ;
            owl:onProperty dob:commitURI ;
            owl:cardinality "1"^^xsd:nonNegativeInteger
        ] ;
    rdfs:label "Code Commit"@en ;
    rdfs:comment "A specific commit or tagged revision of code in a repository."@en .

###################################################
### PROPERTIES
###################################################

### Linking Results to Zones

dob:hasZone a owl:ObjectProperty ;
    rdfs:label "has Zone"@en ;
    rdfs:comment "Links a Result to the BOT Zone it is associated with."@en ;
    rdfs:domain dob:Result ;
    rdfs:range bot:Zone ;
    owl:inverseOf dob:isZoneOfResult .

dob:isZoneOfResult a owl:ObjectProperty ;
    rdfs:label "is Zone of Result"@en ;
    rdfs:comment "Inverse property linking a BOT Zone to its associated Results."@en ;
    rdfs:domain bot:Zone ;
    rdfs:range dob:Result ;
    owl:inverseOf dob:hasZone .

dob:hasUPRN a owl:DatatypeProperty ;
    rdfs:label "Unique Property Reference Number"@en ;
    rdfs:subPropertyOf dct:identifier ;
    rdfs:comment "A unique numeric identifier for every spatial address in Great Britain."@en ;
    rdfs:domain bot:Zone ;
    rdfs:range xsd:integer .


### Linking Process Executions to Pipelines

dob:usedPipeline a owl:ObjectProperty ;
    rdfs:subPropertyOf prov:used ;
    rdfs:label "used Pipeline"@en ;
    rdfs:comment "Links a Process Execution to the Software Pipeline it used."@en ;
    rdfs:domain dob:ProcessExecution ;
    rdfs:range dob:SoftwarePipeline ;
    owl:inverseOf dob:isPipelineOfExecution .

dob:isPipelineOfExecution a owl:ObjectProperty ;
    rdfs:label "is Pipeline of Execution"@en ;
    rdfs:comment "Inverse property linking a Software Pipeline to its Process Executions."@en ;
    rdfs:domain dob:SoftwarePipeline ;
    rdfs:range dob:ProcessExecution ;
    owl:inverseOf dob:usedPipeline .

### Code/Version Control-Related Properties

# 1) usedProcedure (older property referencing a Plan/Association)
dob:usedProcedure a owl:ObjectProperty ;
    rdfs:subPropertyOf prov:hadPlan ;
    rdfs:label "used procedure"@en ;
    rdfs:comment "Links an Activity/Association to the Plan that was used in its execution."@en ;
    rdfs:domain prov:Association ;
    rdfs:range prov:Plan ;
    owl:inverseOf dob:isUsedByProcedure .

dob:isUsedByProcedure a owl:ObjectProperty ;
    rdfs:label "is used by procedure"@en ;
    rdfs:comment "Inverse property linking a Plan to the Activity/Association that used it."@en ;
    rdfs:domain prov:Plan ;
    rdfs:range prov:Association ;
    owl:inverseOf dob:usedProcedure .

# 2) hasCommit

dob:hasCommit a owl:ObjectProperty ;
    rdfs:subPropertyOf prov:wasRevisionOf ;
    rdfs:label "has commit"@en ;
    rdfs:comment "Links a Code Revision to its associated commit."@en ;
    rdfs:domain dob:CodeRevision ;
    rdfs:range dob:CodeCommit ;
    owl:inverseOf dob:isCommitOf .

dob:isCommitOf a owl:ObjectProperty ;
    rdfs:label "is commit of"@en ;
    rdfs:comment "Inverse property linking a Code Commit back to its Code Revision."@en ;
    rdfs:domain dob:CodeCommit ;
    rdfs:range dob:CodeRevision ;
    owl:inverseOf dob:hasCommit .

# 3) usedCommit

dob:usedCommit a owl:ObjectProperty ;
    rdfs:subPropertyOf prov:wasDerivedFrom ;
    rdfs:label "used commit"@en ;
    rdfs:comment "Links a Software Pipeline to the commit it used during execution."@en ;
    rdfs:domain dob:SoftwarePipeline ;
    rdfs:range dob:CodeCommit .

# 4) commitURI

dob:commitURI a owl:DatatypeProperty ;
    rdfs:label "commit URL"@en ;
    rdfs:comment "A full external link for the commit or tag (e.g., on GitHub)."@en ;
    rdfs:domain dob:CodeCommit ;
    rdfs:range xsd:anyURI .

# 5) hasRepository

dob:hasRepository a owl:ObjectProperty ;
    rdfs:label "has repository"@en ;
    rdfs:comment "Links a Software Pipeline to its associated code repository."@en ;
    rdfs:domain dob:SoftwarePipeline ;
    rdfs:range dob:CodeRepository ;
    owl:inverseOf dob:isRepositoryOf .

dob:isRepositoryOf a owl:ObjectProperty ;
    rdfs:label "is repository of"@en ;
    rdfs:comment "Inverse property linking a Code Repository to the Software Pipeline that it is associated with."@en ;
    rdfs:domain dob:CodeRepository ;
    rdfs:range dob:SoftwarePipeline ;
    owl:inverseOf dob:hasRepository .

# 6) hasCodeRevision

dob:hasCodeRevision a owl:ObjectProperty ;
    rdfs:label "has code revision"@en ;
    rdfs:comment "Links a Code Repository to the Code Revisions it contains."@en ;
    rdfs:domain dob:CodeRepository ;
    rdfs:range dob:CodeRevision ;
    owl:inverseOf dob:isCodeRevisionOf .

dob:isCodeRevisionOf a owl:ObjectProperty ;
    rdfs:label "is code revision of"@en ;
    rdfs:comment "Inverse property linking a Code Revision to the Code Repository it belongs to."@en ;
    rdfs:domain dob:CodeRevision ;
    rdfs:range dob:CodeRepository ;
    owl:inverseOf dob:hasCodeRevision .

# 7) usedRevision

dob:usedRevision a owl:ObjectProperty ;
    rdfs:label "used revision"@en ;
    rdfs:comment "Links a Software Pipeline to a specific code revision used in its execution."@en ;
    rdfs:domain dob:SoftwarePipeline ;
    rdfs:range dob:CodeRevision ;
    owl:inverseOf dob:isRevisionOf .

dob:isRevisionOf a owl:ObjectProperty ;
    rdfs:label "is revision of"@en ;
    rdfs:comment "Inverse property linking a Code Revision to the Software Pipeline that used it in execution."@en ;
    rdfs:domain dob:CodeRevision ;
    rdfs:range dob:SoftwarePipeline ;
    owl:inverseOf dob:usedRevision .
